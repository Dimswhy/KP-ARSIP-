<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistem Arsip Profesional</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
  body { background:#f6f7fb; }
  .sidebar { width:220px; background:#0b4f7a; color:#fff; height:100vh; position:fixed; top:0; left:0; display:flex; flex-direction:column; padding-top:20px; }
  .sidebar a { color:#fff; padding:10px 20px; display:block; text-decoration:none; }
  .sidebar a.active, .sidebar a:hover { background:#123a61; }
  .content { margin-left:220px; padding:20px; }
  .table-fixed thead th { position:sticky; top:0; z-index:10; background:#0d6efd; color:#fff; }
  .btn-yellow { background:#ffc107; color:#000; border:0; }
  .btn-red { background:#dc3545; color:#fff; border:0; }
  .small-input { height:36px; padding:6px 10px; }
  table td, table th { vertical-align:middle; }
  @media (max-width:900px){ .table-responsive { font-size:13px; } }
</style>
</head>
<body>

<div class="sidebar">
  <div class="text-center fw-bold mb-3">Aplikasi Arsip</div>
  <a href="#" id="navDashboard" class="active">Dashboard</a>
  <a href="#" id="navArsip">Data Arsip</a>
  <a href="#" id="navKode">Kode Arsip</a>
  <a href="#" id="navBidang">Bidang Arsip</a>
  <a href="#" id="navDisposisi">Disposisi</a>
</div>

<div class="content">
  <!-- Dashboard -->
  <div id="pageDashboard">
    <h4>Dashboard</h4>
    <div class="row g-3 mt-2">
      <div class="col-sm-3"><div class="p-3 bg-white rounded shadow-sm text-center"><div class="text-muted">Total Arsip</div><div id="statTotal" class="fs-4 fw-bold">0</div></div></div>
      <div class="col-sm-3"><div class="p-3 bg-white rounded shadow-sm text-center"><div class="text-muted">Surat Masuk</div><div id="statMasuk" class="fs-4 fw-bold">0</div></div></div>
      <div class="col-sm-3"><div class="p-3 bg-white rounded shadow-sm text-center"><div class="text-muted">Surat Keluar</div><div id="statKeluar" class="fs-4 fw-bold">0</div></div></div>
      <div class="col-sm-3"><div class="p-3 bg-white rounded shadow-sm text-center"><div class="text-muted">Kategori</div><div id="statKategori" class="fs-4 fw-bold">0</div></div></div>
    </div>
  </div>

  <!-- Arsip -->
  <div id="pageArsip" class="d-none">
    <div class="d-flex justify-content-between mb-2">
      <h5>Data Arsip</h5>
      <button class="btn btn-success btn-sm" id="btnAddArsip">+ Tambah Arsip</button>
    </div>
    <div class="table-responsive bg-white rounded shadow-sm p-0">
      <table class="table table-bordered table-fixed mb-0">
        <thead>
          <tr>
            <th>No.</th><th>Kode Box</th><th>Kode Arsip</th><th>Bidang</th><th>Sub Bidang</th><th>Kegiatan</th><th>Tahun</th><th>Status</th><th>Aksi</th>
          </tr>
        </thead>
        <tbody id="tblArsip"></tbody>
      </table>
    </div>
  </div>

  <!-- Kode Arsip -->
  <div id="pageKode" class="d-none">
    <div class="d-flex justify-content-between mb-2">
      <h5>Kode Arsip</h5>
      <button class="btn btn-success btn-sm" id="btnAddKode">+ Tambah Kode</button>
    </div>
    <div class="table-responsive bg-white rounded shadow-sm p-0">
      <table class="table table-bordered table-fixed mb-0">
        <thead><tr><th>No</th><th>Kode</th><th>Keterangan</th><th>Aksi</th></tr></thead>
        <tbody id="tblKode"></tbody>
      </table>
    </div>
  </div>

  <!-- Bidang Arsip -->
  <div id="pageBidang" class="d-none">
    <div class="d-flex justify-content-between mb-2">
      <h5>Bidang Arsip</h5>
      <button class="btn btn-success btn-sm" id="btnAddBidang">+ Tambah Bidang</button>
    </div>
    <div class="table-responsive bg-white rounded shadow-sm p-0">
      <table class="table table-bordered table-fixed mb-0">
        <thead><tr><th>No</th><th>Bidang</th><th>Keterangan</th><th>Aksi</th></tr></thead>
        <tbody id="tblBidang"></tbody>
      </table>
    </div>
  </div>

  <!-- Disposisi -->
  <div id="pageDisposisi" class="d-none">
    <h5>Disposisi Resmi</h5>
    <form id="formDisposisi" class="mb-3 bg-white p-3 rounded shadow-sm">
      <div class="row g-2">
        <div class="col-md-3"><label>Surat</label><select id="dispSelect" class="form-select form-select-sm"></select></div>
        <div class="col-md-3"><label>Sifat</label><select id="dispSifat" class="form-select form-select-sm"><option>Biasa</option><option>Penting</option><option>Segera</option><option>Rahasia</option></select></div>
        <div class="col-md-3"><label>Tanggal</label><input id="dispTanggal" type="date" class="form-control form-control-sm"></div>
        <div class="col-md-3"><label>Diteruskan Kepada</label><input id="dispTo" type="text" class="form-control form-control-sm"></div>
      </div>
      <div class="mt-2"><label>Instruksi / Informasi</label><textarea id="dispInstruksi" rows="3" class="form-control form-control-sm"></textarea></div>
      <div class="mt-2 text-end"><button type="button" class="btn btn-success btn-sm" id="btnSaveDisp">Simpan</button></div>
    </form>
    <div class="table-responsive bg-white rounded shadow-sm p-0">
      <table class="table table-bordered table-sm mb-0">
        <thead><tr><th>No</th><th>Nomor</th><th>Asal</th><th>Sifat</th><th>Diteruskan</th><th>Tgl</th><th>Aksi</th></tr></thead>
        <tbody id="dispHistory"></tbody>
      </table>
    </div>
  </div>
</div>

<!-- Modal Arsip -->
<div class="modal" tabindex="-1" id="modalArsip">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <form id="formArsipModal" class="needs-validation" novalidate>
        <div class="modal-header">
          <h5 class="modal-title">Tambah / Edit Arsip</h5>
          <button type="button" class="btn-close" onclick="bsModal.hide()"></button>
        </div>
        <div class="modal-body">
          <div class="row g-2">
            <input type="hidden" id="editIndex">
            <div class="col-md-3"><input id="f_kodebox" class="form-control form-control-sm" placeholder="Kode Box" required></div>
            <div class="col-md-3"><input id="f_kodearsip" class="form-control form-control-sm" placeholder="Kode Arsip" required></div>
            <div class="col-md-3"><input id="f_bidang" class="form-control form-control-sm" placeholder="Bidang"></div>
            <div class="col-md-3"><input id="f_subbid" class="form-control form-control-sm" placeholder="Sub Bidang"></div>
            <div class="col-md-3"><input id="f_kegiatan" class="form-control form-control-sm" placeholder="Kegiatan"></div>
            <div class="col-md-2"><input id="f_tahun" class="form-control form-control-sm" placeholder="Tahun"></div>
            <div class="col-md-3"><select id="f_status" class="form-select form-select-sm"><option value="ada">Ada</option><option value="pinjam">Pinjam</option></select></div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary btn-sm" onclick="bsModal.hide()">Batal</button>
          <button type="submit" class="btn btn-primary btn-sm">Simpan</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
// ---------- Data ----------
const STORAGE_ARSIP = 'arsip_v1';
const STORAGE_DISP = 'disp_v1';
let arsip = JSON.parse(localStorage.getItem(STORAGE_ARSIP) || '[]');
let disposisi = JSON.parse(localStorage.getItem(STORAGE_DISP) || '[]');
let kodeList = JSON.parse(localStorage.getItem('kode_v1')||'[]');
let bidangList = JSON.parse(localStorage.getItem('bidang_v1')||'[]');

// ---------- Modal ----------
const bsModal = new bootstrap.Modal(document.getElementById('modalArsip'), {backdrop:'static'});

// ---------- Helpers ----------
function saveAll(){ localStorage.setItem(STORAGE_ARSIP, JSON.stringify(arsip)); }
function saveDisp(){ localStorage.setItem(STORAGE_DISP, JSON.stringify(disposisi)); }
function escapeHtml(s){ return s?String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;') : ''; }

// ---------- Page Control ----------
function hideAllPages(){
  document.getElementById('pageDashboard').classList.add('d-none');
  document.getElementById('pageArsip').classList.add('d-none');
  document.getElementById('pageKode').classList.add('d-none');
  document.getElementById('pageBidang').classList.add('d-none');
  document.getElementById('pageDisposisi').classList.add('d-none');
  document.querySelectorAll('.sidebar a').forEach(a=>a.classList.remove('active'));
}

function showPage(page){
  hideAllPages();
  document.getElementById(page).classList.remove('d-none');
  document.getElementById('nav'+page.charAt(0).toUpperCase()+page.slice(1)).classList.add('active');
  if(page==='pageArsip') renderArsip();
  if(page==='pageKode') renderKode();
  if(page==='pageBidang') renderBidang();
  if(page==='pageDisposisi') renderDispSelect(), renderDispHistory();
  if(page==='pageDashboard') updateStats();
}

// ---------- Event Listeners ----------
document.getElementById('navDashboard').addEventListener('click', ()=>showPage('pageDashboard'));
document.getElementById('navArsip').addEventListener('click', ()=>showPage('pageArsip'));
document.getElementById('navKode').addEventListener('click', ()=>showPage('pageKode'));
document.getElementById('navBidang').addEventListener('click', ()=>showPage('pageBidang'));
document.getElementById('navDisposisi').addEventListener('click', ()=>showPage('pageDisposisi'));

document.getElementById('btnAddArsip').addEventListener('click', ()=>openArsipModal());
document.getElementById('formArsipModal').addEventListener('submit', e=>{
  e.preventDefault();
  const idx = document.getElementById('editIndex').value;
  const data = {
    kodebox: document.getElementById('f_kodebox').value.trim(),
    kodearsip: document.getElementById('f_kodearsip').value.trim(),
    bidang: document.getElementById('f_bidang').value.trim(),
    subbid: document.getElementById('f_subbid').value.trim(),
    kegiatan: document.getElementById('f_kegiatan').value.trim(),
    tahun: document.getElementById('f_tahun').value.trim(),
    status: document.getElementById('f_status').value
  };
  if(idx==='') arsip.push(data); else arsip[Number(idx)] = data;
  saveAll();
  bsModal.hide();
  renderArsip();
});

document.getElementById('btnSaveDisp').addEventListener('click', ()=>{
  const idx = document.getElementById('dispSelect').value;
  if(idx==='') return alert('Pilih surat');
  const rec = {
    nomor: arsip[idx].kodearsip || '',
    asal: arsip[idx].bidang || '',
    sifat: document.getElementById('dispSifat').value,
    tgl: document.getElementById('dispTanggal').value||new Date().toISOString().slice(0,10),
    diteruskan: document.getElementById('dispTo').value,
    instruksi: document.getElementById('dispInstruksi').value
  };
  disposisi.unshift(rec);
  saveDisp();
  renderDispHistory();
  alert('Disposisi tersimpan');
});

// ---------- Render Functions ----------
function updateStats(){
  document.getElementById('statTotal').innerText = arsip.length;
  document.getElementById('statMasuk').innerText = arsip.filter(a=>a.status==='ada').length;
  document.getElementById('statKeluar').innerText = arsip.filter(a=>a.status==='pinjam').length;
  document.getElementById('statKategori').innerText = 4;
}

function renderArsip(){
  const tbody = document.getElementById('tblArsip'); tbody.innerHTML='';
  arsip.forEach((d,i)=>{
    tbody.insertAdjacentHTML('beforeend', `<tr>
      <td>${i+1}</td><td>${escapeHtml(d.kodebox)}</td><td>${escapeHtml(d.kodearsip)}</td>
      <td>${escapeHtml(d.bidang)}</td><td>${escapeHtml(d.subbid)}</td><td>${escapeHtml(d.kegiatan)}</td>
      <td>${escapeHtml(d.tahun)}</td><td>${escapeHtml(d.status)}</td>
      <td>
        <button class="btn btn-sm btn-yellow" onclick="editArsip(${i})">Edit</button>
        <button class="btn btn-sm btn-red" onclick="deleteArsip(${i})">Hapus</button>
      </td>
    </tr>`);
  });
}

function openArsipModal(idx=null){
  document.getElementById('formArsipModal').reset();
  document.getElementById('editIndex').value = idx!==null?idx:'';
  if(idx!==null){
    const d = arsip[idx];
    document.getElementById('f_kodebox').value = d.kodebox;
    document.getElementById('f_kodearsip').value = d.kodearsip;
    document.getElementById('f_bidang').value = d.bidang;
    document.getElementById('f_subbid').value = d.subbid;
    document.getElementById('f_kegiatan').value = d.kegiatan;
    document.getElementById('f_tahun').value = d.tahun;
    document.getElementById('f_status').value = d.status;
  }
  bsModal.show();
}

function editArsip(i){ openArsipModal(i); }
function deleteArsip(i){ if(confirm('Hapus arsip ini?')){ arsip.splice(i,1); saveAll(); renderArsip(); } }

function renderDispSelect(){
  const sel = document.getElementById('dispSelect'); sel.innerHTML='<option value="">-- pilih surat --</option>';
  arsip.forEach((a,i)=>sel.insertAdjacentHTML('beforeend', `<option value="${i}">${a.kodearsip||a.kegiatan||'No '+(i+1)}</option>`));
}

function renderDispHistory(){
  const tbody = document.getElementById('dispHistory'); tbody.innerHTML='';
  disposisi.forEach((d,i)=>{ tbody.insertAdjacentHTML('beforeend', `<tr>
    <td>${i+1}</td><td>${escapeHtml(d.nomor)}</td><td>${escapeHtml(d.asal)}</td>
    <td>${escapeHtml(d.sifat)}</td><td>${escapeHtml(d.diteruskan)}</td>
    <td>${escapeHtml(d.tgl)}</td><td><button class="btn btn-sm btn-secondary" onclick="viewDisp(${i})">Lihat</button></td>
  </tr>`); });
}

function viewDisp(i){
  const d = disposisi[i];
  const w = window.open('', '_blank');
  w.document.write(`<html><head><title>Disposisi</title>
  <style>body{font-family:Arial;padding:20px} table{width:100%;border-collapse:collapse} td,th{border:1px solid #ccc;padding:8px}</style>
  </head><body><h3>Lembar Disposisi</h3>
  <table>
  <tr><th>Nomor</th><td>${escapeHtml(d.nomor)}</td></tr>
  <tr><th>Asal</th><td>${escapeHtml(d.asal)}</td></tr>
  <tr><th>Sifat</th><td>${escapeHtml(d.sifat)}</td></tr>
  <tr><th>Diteruskan Kepada</th><td>${escapeHtml(d.diteruskan)}</td></tr>
  <tr><th>Tanggal</th><td>${escapeHtml(d.tgl)}</td></tr>
  <tr><th>Instruksi</th><td>${escapeHtml(d.instruksi)}</td></tr>
  </table></body></html>`);
  w.print();
}

// ---------- Kode & Bidang ----------
document.getElementById('btnAddKode').addEventListener('click', ()=>{
  const kode = prompt('Kode Arsip:'); if(!kode) return;
  const ket = prompt('Keterangan:'); kodeList.push({kode, ket}); localStorage.setItem('kode_v1', JSON.stringify(kodeList)); renderKode();
});
function renderKode(){
  const tbody = document.getElementById('tblKode'); tbody.innerHTML='';
  kodeList.forEach((k,i)=>tbody.insertAdjacentHTML('beforeend', `<tr>
    <td>${i+1}</td><td>${escapeHtml(k.kode)}</td><td>${escapeHtml(k.ket)}</td>
    <td><button class="btn btn-sm btn-red" onclick="delKode(${i})">Hapus</button></td>
  </tr>`));
}
function delKode(i){ if(confirm('Hapus kode ini?')){ kodeList.splice(i,1); localStorage.setItem('kode_v1', JSON.stringify(kodeList)); renderKode(); } }

document.getElementById('btnAddBidang').addEventListener('click', ()=>{
  const nama = prompt('Nama Bidang:'); if(!nama) return;
  const ket = prompt('Keterangan:'); bidangList.push({nama, ket}); localStorage.setItem('bidang_v1', JSON.stringify(bidangList)); renderBidang();
});
function renderBidang(){
  const tbody = document.getElementById('tblBidang'); tbody.innerHTML='';
  bidangList.forEach((b,i)=>tbody.insertAdjacentHTML('beforeend', `<tr>
    <td>${i+1}</td><td>${escapeHtml(b.nama)}</td><td>${escapeHtml(b.ket)}</td>
    <td><button class="btn btn-sm btn-red" onclick="delBidang(${i})">Hapus</button></td>
  </tr>`));
}
function delBidang(i){ if(confirm('Hapus bidang ini?')){ bidangList.splice(i,1); localStorage.setItem('bidang_v1', JSON.stringify(bidangList)); renderBidang(); } }

// ---------- Init ----------
showPage('pageDashboard');
</script>
</body>
</html>
